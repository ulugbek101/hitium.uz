{% extends 'base2.html' %}
{% load i18n static %}

{% block content %}
    <section style="background-image: url('{% static 'images/home-page-header-bg.jpg' %}'); background-repeat: no-repeat; background-size: cover; background-position: bottom;" class="text-center py-12 lg:py-24 px-1 lg:px-5 bg-linear-to-b from-[#ff5a00]/10 to-transparent border-b border-white/5"
            id="home">
        <h1 class="font-display text-2xl lg:text-4xl font-bold text-white tracking-tight">{% trans 'HITIUM — инженерные системы и монтаж' %}</h1>
        <p class="text-white mt-3 max-w-2xl mx-auto text-sm lg:text-base">{% trans 'Мы создаём надёжные инженерные решения, которые делают здания комфортными, безопасными и энергоэффективными.' %}</p>

        <div class="flex flex-row items-center justify-center gap-4 flex-wrap mt-6">
            <a href="tel:+998901234567"
            class="text-md lg:text-base px-3 lg:px-6 py-1 lg:py-3 rounded lg:rounded-lg bg-[#ff5a00] font-semibold lg:font-bold shadow-lg shadow-[#ff5a00]/20 hover:bg-[#d94e00] transition">{% trans 'Позвонить' %}</a>
            <a href="https://t.me/hitium"
            class="text-md lg:text-base px-3 lg:px-6 py-1 lg:py-3 rounded lg:rounded-lg bg-[#ff5a00] font-semibold lg:font-bold shadow-lg shadow-[#ff5a00]/20 hover:bg-[#d94e00] transition">{% trans 'Написать в Telegram' %}</a>
        </div>
    </section>

    <section id="about" class="max-w-5xl mx-auto px-1 lg:px-5 py-8 lg:py-16">
        <h2 class="font-display text-2xl lg:text-4xl text-[#ff5a00] font-semibold text-center">{% trans 'О компании' %}</h2>
        <div class="h-[1px] w-full xl:w-64 bg-[#a5a5a5] m-auto my-2 lg:my-5"></div>
        <p class="text-[#a5a5a5] mt-2 text-sm lg:text-base text-justify lg:text-center">{% trans 'HITIUM — эксперт в области проектирования, монтажа и обслуживания инженерных систем. Мы объединяем технологии, опыт и инновации, чтобы создавать решения, отвечающие самым высоким стандартам качества.' %}</p>
    </section>

    <section id="mission" class="max-w-5xl mx-auto px-1 lg:px-5 py-2 lg:py-6">
        <div class="text-center mx-auto border-2 border-[#ff5a00] rounded lg:rounded-xl p-6 max-w-xl bg-black text-white">
            <div class="flex flex-col gap-0 lg:gap-2">
                <img src="https://hitium.uz/static/images/nav-logo.png" class="h-12 rounded-md object-contain mx-auto"/>
                <h2 class="font-display font-bold text-white text-xl mt-3">{% trans 'Наша миссия' %}</h2>
            </div>
            <p class="mt-2 text-white text-sm lg:text-base text-justify lg:text-center">{% trans 'Улучшать конкурентоспособность клиентов, превращая современные технологии в реальные результаты и преимущества.' %}</p>
            <div class="text-right italic mt-3 text-white">{% trans 'Тимур Хисамов' %}</div>
        </div>
    </section>

    <section id="about" class="max-w-5xl mx-auto px-1 lg:px-5 py-8 lg:py-16">
        <h2 class="font-display text-2xl lg:text-4xl text-[#ff5a00] font-semibold text-center">{% trans 'Наши услуги' %}</h2>
        <div class="h-[1px] w-full xl:w-64 bg-[#a5a5a5] m-auto my-2 lg:my-5"></div>

        <div class="grid gap-6 mt-7 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
            {% for service in services %}
                <a href="{% url 'service_detail' slug=service.slug id=service.id %}" class="bg-white/5 rounded-xl p-4 text-center hover:text-[#ff5a00] hover:bg-white/10 transition">
                    <img src="/media/{{ service.header_bg }}" class="h-[200px] w-full rounded-lg mb-3"/>
                    <h3 class="font-display text-lg py-2.5">{{ service.name }}</h3>
                </a>
            {% endfor %}
        </div>
    </section>

    <section id="about" class="max-w-5xl mx-auto px-1 lg:px-5 py-8 lg:py-16">
        <h2 class="font-display text-2xl lg:text-4xl text-[#ff5a00] font-semibold text-center">{% trans 'Отзывы' %}</h2>
        <div class="h-[1px] w-full xl:w-64 bg-[#a5a5a5] m-auto my-2 lg:my-5"></div>

        <div class="reviews-wrapper">
            <div class="reviews-track">
                {% for review in reviews %}
                    <div class="bg-white/5 rounded-xl p-2 hover:bg-white/10 transition min-w-[250px]">
                        <div class="flex flex-col justify-center items-center h-full gap-4">
                            <div class="w-full relative video-wrapper hover:cursor-pointer">
                                <video src="{{ review.video.url }}" class="w-full rounded-xl review-video"></video>
                                <span class="player-btn material-icons
                                    transition rounded-full px-4 py-3 bg-[#d94e00] text-white select-none
                                    text-2xl absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2
                                    flex items-center justify-center hover:scale-105">
                                    play_arrow
                                </span>
                            </div>
                            <h2 class="mt-auto text-[#a5a5a5] text-center font-semibold text-lg transition">{{ review.fullname }}</h2>
                        </div>
                    </div>
                {% endfor %}
                {% for review in reviews %}
                    <div class="bg-white/5 rounded-xl p-2 hover:bg-white/10 transition min-w-[250px]">
                        <div class="flex flex-col justify-center items-center h-full gap-4">
                            <div class="w-full relative video-wrapper hover:cursor-pointer">
                                <video src="{{ review.video.url }}" class="w-full rounded-xl review-video"></video>
                                <span class="player-btn material-icons
                                    transition rounded-full px-4 py-3 bg-[#d94e00] text-white select-none
                                    text-2xl absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2
                                    flex items-center justify-center hover:scale-105">
                                    play_arrow
                                </span>
                            </div>
                            <h2 class="mt-auto text-[#a5a5a5] text-center font-semibold text-lg transition">{{ review.fullname }}</h2>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <style>
            .reviews-wrapper {
                width: 100%;
                overflow: hidden;
                position: relative;
            }

            .reviews-track {
                display: flex;
                gap: 20px;
                animation: scroll-left 10s linear infinite;
            }

            .reviews-wrapper:hover .reviews-track {
                animation-play-state: paused;
            }

            @keyframes scroll-left {
                0% {
                    transform: translateX(0);
                }
                100% {
                    transform: translateX(-50%);
                }
            }
        </style>

    </section>



    <section id="about" class="max-w-5xl mx-auto px-1 lg:px-5 py-8 lg:py-16">
        <h2 class="font-display text-2xl lg:text-4xl text-[#ff5a00] font-semibold text-center">{% trans 'Проекты' %}</h2>
        <div class="h-[1px] w-full xl:w-64 bg-[#a5a5a5] m-auto my-2 lg:my-5"></div>
        {% if projects.exists %}
            <div class="grid grid-cols-12 px-4 lg:px-0 gap-4 lg:gap-0">
                {% for project in projects %}
                    <a href="{% url 'project_detail' slug=project.slug id=project.id %}" class="text-[#a5a5a5] hover:text-[#ff5a00] bg-white/5 rounded lg:rounded-xl p-3 lg:p-4 text-center hover:bg-white/10 transition col-span-12 lg:col-span-3">
                        <img src="{% if project.project_images.first %}{{ project.project_images.first.image.url }}{% else %}https://atlantawatershed.org/wp-content/uploads/2017/06/default-placeholder-570x321.png{% endif %}" class="max-h-[250px] w-full rounded lg:rounded-lg mb-1 lg:mb-3">
                        <h3 class="font-display text-lg">{{ project.name }}</h3>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-[#a5a5a5] mt-2 text-center">{% trans 'Проекты пока не добавлены' %}</p>
        {% endif %}
    </section>

    <section id="about" class="max-w-5xl mx-auto px-1 lg:px-5 py-8 lg:py-16">
        <h2 class="font-display text-2xl lg:text-4xl text-[#ff5a00] font-semibold text-center">{% trans 'Наши клиенты' %}</h2>
        <div class="h-[1px] w-full xl:w-64 bg-[#a5a5a5] m-auto my-2 lg:my-5"></div>
        {% if clients.exists %}
            <div class="grid grid-cols-12 gap-y-4">
                {% for client in clients %}
                    <div class="flex flex-col items-center gap-1 col-span-6 lg:col-span-3 flex flex-col justify-between">
                        <div class="rounded-xl p-0 lg:p-4 text-center text-[#a5a5a5] hover:text-[#ff5a00] hover:cursor-pointer transition">
                            <img src="{{ client.image.url }}" class="max-h-[100px] h-full w-full rounded-lg mb-3"/>
                            <h3 class="font-display text-lg">{{ client.name }}</h3>
                        </div>
                        {% if client.link %}
                            <a href="{{ client.link }}" class="flex flex-row items-center gap-1 text-sm text-[#a5a5a5] hover:text-blue-500 transition">
                                {% trans 'Сайт организации' %}
                                <span class="material-icons !text-sm">arrow_outward</span>
                            </a>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-[#a5a5a5] mt-2 text-center">{% trans 'Клиенты пока не добавлены' %}</p>
        {% endif %}
    </section>

    <!-- Modal remains unchanged except no trans needed -->
    <div id="imageModal"
     class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50">
        <button id="closeModal"
                class="absolute top-4 right-4 text-white text-3xl material-icons hover:scale-110 transition">
            close
        </button>

        <div class="flex flex-col gap-4 max-w-4xl w-full">
            <img id="modalImage"
                class="max-h-[80vh] min-h-[40vh] max-w-full rounded-xl shadow-2xl object-contain mx-auto"/>

            <span id="modalImageDescription"
                class="text-[#a5a5a5] text-lg leading-relaxed text-justify max-h-[40vh] overflow-y-auto"></span>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const modal = document.getElementById("imageModal");
            const modalImage = document.getElementById("modalImage");
            const modalImageDescription = document.getElementById("modalImageDescription");
            const closeModal = document.getElementById("closeModal");
            const wrappers = document.querySelectorAll(".video-wrapper");
            const videos = document.querySelectorAll(".review-video");

            function pauseAllExcept(current) {
                videos.forEach(v => {
                    if (v !== current) {
                        v.pause();
                        const btn = v.parentElement.querySelector(".player-btn");
                        btn.textContent = "play_arrow";
                        btn.style.opacity = 1; // always show play icon when paused
                    }
                });
            }

            wrappers.forEach(wrapper => {
                const video = wrapper.querySelector(".review-video");
                const btn = wrapper.querySelector(".player-btn");

                // Always show play icon when paused
                video.addEventListener("pause", () => {
                    btn.textContent = "play_arrow";
                    btn.style.opacity = 1;
                });

                // Hide icon while playing (but show on hover)
                video.addEventListener("play", () => {
                    btn.textContent = "pause";
                    btn.style.opacity = 0; // hidden by default
                });

                // Show pause icon when hovered during play
                wrapper.addEventListener("mouseenter", () => {
                    if (!video.paused) btn.style.opacity = 1;
                });

                // Hide pause icon when leaving (only if playing)
                wrapper.addEventListener("mouseleave", () => {
                    if (!video.paused) btn.style.opacity = 0;
                });

                // Clicking the button
                btn.addEventListener("click", (e) => {
                    e.stopPropagation();

                    if (video.paused) {
                        pauseAllExcept(video);
                        video.play();
                    } else {
                        video.pause();
                    }
                });

                // Clicking the video itself
                video.addEventListener("click", () => {
                    if (video.paused) {
                        pauseAllExcept(video);
                        video.play();
                    } else {
                        video.pause();
                    }
                });

                // On ended → show play button
                video.addEventListener("ended", () => {
                    btn.textContent = "play_arrow";
                    btn.style.opacity = 1;
                });
            });

            // Open modal
            document.querySelectorAll(".preview-img").forEach(img => {
                img.addEventListener("click", () => {
                    modalImage.src = img.src;
                    modalImageDescription.textContent = img.dataset.description;

                    modal.classList.remove("hidden");
                    modal.classList.add("flex");

                    // LOCK screen scroll
                    document.body.style.overflow = "hidden";
                });
            });

            function close() {
                modal.classList.add("hidden");
                modal.classList.remove("flex");
                modalImage.src = "";

                // RESTORE scroll
                document.body.style.overflow = "";
            }

            closeModal.addEventListener("click", close);

            // Close by clicking outside content
            modal.addEventListener("click", (e) => {
                if (e.target === modal) close();
            });
        });
    </script>
{% endblock content %}
